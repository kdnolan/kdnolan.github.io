<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>kman2140</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Favicon (leave as-is, or swap if you want) -->
  <link
    rel="icon"
    type="image/png"
    href="https://raw.githubusercontent.com/kdnolan/kdnolan.github.io/master/avatars/avatar.png"
  />

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <style>
    html, body { margin: 0; height: 100%; background: #000; }

    /* NPUB overlay (responsive, fits phone + desktop) */
    .selectable {
      position: fixed;
      left: 50%;
      top: 46%;
      transform: translate(-50%, -50%);

      max-width: min(1000px, 92vw);
      padding: 12px 14px;
      border-radius: 14px;

      background: transparent;
      color: white;

      font: 700 clamp(14px, 2.8vw, 22px) / 1.25
        ui-monospace, SFMono-Regular, Menlo, Monaco,
        Consolas, "Liberation Mono", "Courier New", monospace;

      white-space: normal;
      overflow-wrap: anywhere;
      word-break: break-word;
      text-align: center;

      text-shadow:
        0 0 10px rgba(138, 43, 226, 0.95),
        0 0 22px rgba(138, 43, 226, 0.8),
        0 0 34px rgba(138, 43, 226, 0.55);

      user-select: text;
      -webkit-user-select: text;
      pointer-events: auto;
      z-index: 10;
    }

    .hint, .toast {
      position: fixed;
      left: 12px;
      right: 12px;
      padding: 10px 12px;
      border-radius: 10px;
      background: rgba(0,0,0,0.55);
      color: #fff;
      font: 14px system-ui, sans-serif;
      z-index: 11;
      max-width: 640px;
    }

    .hint { bottom: calc(12px + env(safe-area-inset-bottom)); }
    .toast {
      bottom: calc(56px + env(safe-area-inset-bottom));
      opacity: 0;
      transition: opacity .25s ease;
      pointer-events: none;
    }

    textarea#copyFallback { position: fixed; left: -9999px; top: -9999px; }

    /* Phone-specific tightening */
    @media (max-width: 520px) {
      .selectable {
        top: 44%;
        max-width: 94vw;
        padding: 10px 12px;
        font-size: clamp(12px, 4.2vw, 16px);
        line-height: 1.22;
      }
    }
    @media (max-width: 360px) {
      .selectable { font-size: clamp(11px, 4.6vw, 15px); }
    }
  </style>

  <script>
    const NPUB =
      "npub1cyla8qgt9gv8y6ydv8s2prt89h8afc0sr2kaz64ryjmlpdrzxm4qwlh53q";

    function showToast(msg) {
      const t = document.getElementById("toast");
      t.textContent = msg;
      t.style.opacity = "1";
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(() => (t.style.opacity = "0"), 1400);
    }

    async function copyText(text) {
      try {
        if (navigator.clipboard && window.isSecureContext) {
          await navigator.clipboard.writeText(text);
          return true;
        }
      } catch {}

      try {
        const ta = document.getElementById("copyFallback");
        ta.value = text;
        ta.select();
        return document.execCommand("copy");
      } catch {}

      return false;
    }

    // Cursor: mouse (desktop), gaze (mobile)
    AFRAME.registerComponent("auto-cursor", {
      init: function () {
        const scene = this.el;
        const cam = scene.querySelector("[camera]");
        if (!cam) return;

        if (!AFRAME.utils.device.isMobile()) {
          const cur = document.createElement("a-entity");
          cur.setAttribute("cursor", "rayOrigin: mouse; fuse: false");
          cur.setAttribute("raycaster", "objects: .clickable");
          scene.appendChild(cur);
        } else {
          const gaze = document.createElement("a-entity");
          gaze.className = "gaze-cursor";
          gaze.setAttribute("cursor", "fuse: true; fuseTimeout: 700");
          gaze.setAttribute("position", "0 0 -1");
          gaze.setAttribute("geometry", "primitive: ring; radiusInner: 0.012; radiusOuter: 0.02");
          gaze.setAttribute("material", "shader: flat; color: white; opacity: 0.95");
          gaze.setAttribute("raycaster", "objects: .clickable");
          cam.appendChild(gaze);
        }
      }
    });

    // Subtle parallax between sky + avatar based on camera movement
    AFRAME.registerComponent("parallax-sky", {
      schema: { yawFactor: {type: "number", default: 0.06} },
      init: function () {
        this.cam = this.el.sceneEl.querySelector("[camera]");
        this.baseRot = this.el.object3D.rotation.clone();
      },
      tick: function () {
        if (!this.cam) return;
        const yaw = this.cam.object3D.rotation.y; // radians
        // Drift sky slightly opposite to camera yaw for depth illusion
        this.el.object3D.rotation.y = this.baseRot.y + (-yaw * this.data.yawFactor);
      }
    });

    AFRAME.registerComponent("parallax-avatar", {
      schema: {
        factor: {type: "number", default: 0.18},     // how much the avatar shifts vs camera x/z
        maxShift: {type: "number", default: 0.35}    // clamp so it stays subtle
      },
      init: function () {
        this.camRig = this.el.sceneEl.querySelector("#camRig");
        this.basePos = this.el.object3D.position.clone();
      },
      tick: function () {
        if (!this.camRig) return;
        const p = this.camRig.object3D.position;

        // Shift opposite your movement so the avatar feels closer than the sky
        const sx = THREE.MathUtils.clamp(-p.x * this.data.factor, -this.data.maxShift, this.data.maxShift);
        const sz = THREE.MathUtils.clamp(-p.z * this.data.factor, -this.data.maxShift, this.data.maxShift);

        this.el.object3D.position.x = this.basePos.x + sx;
        this.el.object3D.position.z = this.basePos.z + sz;
      }
    });

    window.addEventListener("DOMContentLoaded", () => {
      const overlay = document.getElementById("npubOverlay");
      overlay.textContent = NPUB;
      overlay.onclick = async () => {
        const ok = await copyText(NPUB);
        showToast(ok ? "Copied npub" : "Copy blocked");
      };
    });
  </script>
</head>

<body>
  <textarea id="copyFallback"></textarea>

  <div id="npubOverlay" class="selectable" title="Tap/click to copy, or drag to highlight"></div>
  <div id="toast" class="toast"></div>
  <div class="hint">
    Desktop: WASD + mouse · Mobile: drag to look · Tap NPUB to copy
  </div>

  <a-scene auto-cursor renderer="colorManagement: true; pixelRatio: devicePixelRatio">
    <a-assets>
      <img
        id="city"
        crossorigin="anonymous"
        src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/city.jpg"
      />

      <!-- Laser eyes avatar (use RAW githubusercontent to avoid black-box) -->
      <img
        id="laser"
        crossorigin="anonymous"
        src="https://raw.githubusercontent.com/kdnolan/kdnolan.github.io/master/avatars/lasereyes.jpeg"
      />
    </a-assets>

    <!-- Camera rig (so parallax can read WASD movement cleanly) -->
    <a-entity id="camRig" position="0 1.6 0">
      <a-camera wasd-controls="acceleration: 18"></a-camera>
    </a-entity>

    <!-- Sky with subtle parallax drift -->
    <a-sky src="#city" rotation="0 -90 0" parallax-sky="yawFactor: 0.06"></a-sky>

    <!-- Avatar (closer) with subtle parallax -->
    <a-entity
      parallax-avatar="factor: 0.18; maxShift: 0.35"
      position="0 1.68 -4.0"
      look-at="[camera]"
      animation="property: position; dir: alternate; dur: 4200; easing: easeInOutSine; loop: true; to: 0 1.92 -4.0">

      <!-- Purple halo (circle behind) -->
      <a-entity
        geometry="primitive: circle; radius: 0.95"
        position="0 0 -0.03"
        material="shader: flat; color: #8A2BE2; opacity: 0.14; transparent: true; side: double">
      </a-entity>

      <!-- Main laser-eyes avatar (circle mask) -->
      <a-entity
        geometry="primitive: circle; radius: 0.82"
        material="shader: flat; src: #laser; opacity: 0.98; transparent: true; side: double">
      </a-entity>
    </a-entity>

    <a-entity light="type: ambient; intensity: 0.9"></a-entity>
  </a-scene>
</body>
</html>
